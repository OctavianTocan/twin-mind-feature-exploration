<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Set base font */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Ensure html and body take full height for a mobile-like view */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        /* Custom styles for the dark blue color */
        .btn-primary {
            background-color: #0B4F75;
            color: white;
            padding: 0.5rem 1.5rem; /* py-2 px-6 */
            font-size: 0.875rem; /* text-sm */
            border-radius: 0.5rem; /* rounded-lg */
            transition-property: background-color;
            transition-duration: 150ms;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.25rem; /* leading-5 */
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #0a4268;
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Custom styles for the toggle switch - Increased size for better touch target */
        .toggle-switch-container {
            padding: 0.5rem; /* Add padding around the toggle for easier tap */
            border-radius: 0.5rem;
            margin: -0.5rem; /* Negative margin to counteract the padding for spacing */
        }
        .toggle-switch-container:hover {
            background-color: #f3f4f6; /* Subtle hover effect */
        }
        .toggle-track {
            height: 1.5rem; /* Increased height */
            width: 2.75rem; /* Increased width */
        }
        .toggle-ball {
            height: 1.25rem; /* Increased height */
            width: 1.25rem; /* Increased width */
        }
        .toggle-checkbox:checked + .toggle-label .toggle-ball {
            transform: translateX(1.25rem); /* Adjusted transform to match new track size */
        }

        .toggle-checkbox:checked {
            background-color: #0B4F75; /* Custom Blue */
            right: 0;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #0B4F75; /* Custom Blue */
        }
        .toggle-checkbox:checked + .toggle-label .toggle-ball {
            transform: translateX(1.5rem); /* Adjusted transform to match new track size */
        }

        /* Custom styles for the header button text color (from the light mode images) */
        .text-blue-primary {
            color: #0B4F75;
        }
    </style>
</head>
<body class="bg-gray-100 text-black flex justify-center items-start min-h-screen py-8">
    <!-- Main container with mobile-like constraints -->
    <div class="w-full max-w-md bg-white p-5 flex flex-col rounded-lg shadow-lg">
        
        <!-- Top navigation: Back, Title, and Save buttons -->
        <header class="flex justify-between items-center mb-6 w-full">
            <button class="text-blue-primary text-base rounded-full px-2 py-1 flex items-center gap-1 hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                Back
            </button>
            <h1 class="text-lg font-semibold">Dictionary</h1>
            <button class="text-blue-primary text-base rounded-full px-3 py-1 font-medium hover:bg-gray-100">Save</button>
        </header>

        <!-- Main content area -->
        <main class="flex-grow w-full">
            
            <!-- Explanatory Text -->
            <p class="text-gray-600 text-sm mb-6">
                Add words and corrections to your dictionary. This helps improve transcription accuracy for unique names and terms.
            </p>

            <!-- Inline "Add new word" Form -->
            <div class="mb-6">
                <h2 class="text-lg font-bold mb-3">Add new word</h2>

                <!-- Toggle for 'Correct a misspelling' -->
                <div class="flex items-center justify-between mb-5">
                    <label for="addFormMisspellingToggle" class="text-gray-700 font-medium text-sm">Correct a misspelling</label>
                    <!-- Increased touch target area -->
                    <button class="relative inline-flex items-center toggle-switch-container" role="switch" aria-checked="false" id="addFormToggleButton">
                        <input type="checkbox" id="addFormMisspellingToggle" class="sr-only toggle-checkbox" />
                        <span class="sr-only">Correct a misspelling</span>
                        <span class="inline-block toggle-track h-5 w-9 rounded-full transition-colors bg-gray-300 relative">
                            <span class="inline-block toggle-ball w-4 h-4 transform bg-white rounded-full shadow transition-transform absolute left-[2px] top-[2px]"></span>
                        </span>
                    </button>
                </div>

                <!-- Input fields for Add Form -->
                <div class="space-y-3">
                    <!-- Single word input -->
                    <div id="addFormSingleWordContainer">
                        <label for="addFormSingleWordInput" class="sr-only">Add a new word</label>
                        <input 
                            type="text" 
                            id="addFormSingleWordInput"
                            placeholder="Add a new word" 
                            class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                        >
                    </div>

                    <!-- Replacement inputs (hidden by default) -->
                    <div id="addFormReplacementContainer" class="hidden flex items-center gap-3">
                        <input 
                            type="text" 
                            id="addFormWordToReplaceInput"
                            placeholder="Misspelling" 
                            class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                        >
                        <span class="text-[#0B4F75] text-xl">&rarr;</span>
                        <input 
                            type="text" 
                            id="addFormReplaceWithInput"
                            placeholder="Correct spelling" 
                            class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                        >
                    </div>
                </div>

                <!-- Add Button for Inline Form - Using custom class for styling -->
                <button id="addFormSaveButton" class="btn-primary w-full mt-5">
                    Add word
                </button>
            </div>

            <!-- Divider -->
            <hr class="border-t-2 border-gray-200 my-6">

            <!-- Dictionary List Container -->
            <div id="dictionaryListContainer" class="flex flex-col w-full">
                <!-- Dictionary items will be dynamically added here -->
            </div>

        </main>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

    <!-- Edit Modal (was Add/Edit Modal) -->
    <div id="editModal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white w-full max-w-md p-6 rounded-lg shadow-2xl hidden z-50">
        <h2 id="modalTitle" class="text-xl font-bold mb-5">Edit word</h2>

        <!-- Toggle for 'Correct a misspelling' -->
        <div class="flex items-center justify-between mb-5">
            <label for="misspellingToggle" class="text-gray-700 font-medium text-sm">Correct a misspelling</label>
            <!-- Increased touch target area -->
            <button class="relative inline-flex items-center toggle-switch-container" role="switch" aria-checked="false" id="toggleButton">
                <input type="checkbox" id="misspellingToggle" class="sr-only toggle-checkbox" />
                <span class="sr-only">Correct a misspelling</span>
                <span class="inline-block toggle-track h-5 w-9 rounded-full transition-colors bg-gray-300 relative">
                    <span class="inline-block toggle-ball w-4 h-4 transform bg-white rounded-full shadow transition-transform absolute left-[2px] top-[2px]"></span>
                </span>
            </button>
        </div>

        <!-- Input fields -->
        <div class="space-y-3">
            <!-- Single word input -->
            <div id="singleWordInputContainer">
                <label for="singleWordInput" class="sr-only">Add a new word</label>
                <input 
                    type="text" 
                    id="singleWordInput"
                    placeholder="Add a new word" 
                    class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                >
            </div>

            <!-- Replacement inputs (hidden by default) -->
            <div id="replacementInputContainer" class="hidden flex items-center gap-3">
                <input 
                    type="text" 
                    id="wordToReplaceInput"
                    placeholder="Misspelling" 
                    class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                >
                <span class="text-[#0B4F75] text-xl">&rarr;</span>
                <input 
                    type="text" 
                    id="replaceWithInput"
                    placeholder="Correct spelling" 
                    class="w-full bg-gray-50 border border-gray-300 text-black text-sm rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-[#0B4F75]"
                >
            </div>
        </div>

        <!-- Modal buttons -->
        <div class="flex justify-end items-center gap-3 mt-6">
            <button id="deleteButton" class="text-red-600 hover:bg-red-100 font-medium rounded-lg text-sm px-5 py-2.5 hidden mr-auto">Delete</button>
            <button id="cancelButton" class="text-gray-700 bg-gray-100 hover:bg-gray-200 font-medium rounded-lg text-sm px-5 py-2.5">Cancel</button>
            <!-- Save Button - Using custom class for styling -->
            <button id="saveButton" class="btn-primary">Save changes</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE ---
            let dictionaryItems = [
                { id: crypto.randomUUID(), type: 'replacement', from: 'open memory', to: 'OpenMemory' },
                { id: crypto.randomUUID(), type: 'word', word: 'tocanoctavian@gmail.com' },
                { id: crypto.randomUUID(), type: 'word', word: 'Octavian Tocan' },
                { id: crypto.randomUUID(), type: 'word', word: 'Pieces for Desktop' },
                { id: crypto.randomUUID(), type: 'word', word: 'Ollama' },
                { id: crypto.randomUUID(), type: 'word', word: 'Figma Jam' },
                { id: crypto.randomUUID(), type: 'word', word: 'procedural' },
                { id: crypto.randomUUID(), type: 'replacement', from: 'mem0', to: 'Mem0' },
                { id: crypto.randomUUID(), type: 'replacement', from: 'memzero', to: 'Mem0' },
            ];
            let editingItemId = null;

            // --- SELECTORS ---
            const listContainer = document.getElementById('dictionaryListContainer');
            const modalOverlay = document.getElementById('modalOverlay');
            
            // Edit Modal Selectors
            const editModal = document.getElementById('editModal');
            const modalTitle = document.getElementById('modalTitle');
            const toggleButton = document.getElementById('toggleButton');
            const misspellingToggle = document.getElementById('misspellingToggle');
            const singleWordContainer = document.getElementById('singleWordInputContainer');
            const replacementContainer = document.getElementById('replacementInputContainer');
            const singleWordInput = document.getElementById('singleWordInput');
            const wordToReplaceInput = document.getElementById('wordToReplaceInput');
            const replaceWithInput = document.getElementById('replaceWithInput');
            const deleteButton = document.getElementById('deleteButton');
            const cancelButton = document.getElementById('cancelButton');
            const saveButton = document.getElementById('saveButton');

            // Add Form Selectors
            const addFormToggleButton = document.getElementById('addFormToggleButton');
            const addFormMisspellingToggle = document.getElementById('addFormMisspellingToggle');
            const addFormSingleWordContainer = document.getElementById('addFormSingleWordContainer');
            const addFormReplacementContainer = document.getElementById('addFormReplacementContainer');
            const addFormSingleWordInput = document.getElementById('addFormSingleWordInput');
            const addFormWordToReplaceInput = document.getElementById('addFormWordToReplaceInput');
            const addFormReplaceWithInput = document.getElementById('addFormReplaceWithInput');
            const addFormSaveButton = document.getElementById('addFormSaveButton');


            // --- FUNCTIONS ---

            // Render the entire list of dictionary items
            const renderList = () => {
                listContainer.innerHTML = ''; // Clear existing list
                
                if (dictionaryItems.length === 0) {
                    listContainer.innerHTML = `<p class="text-gray-500 text-center py-3 text-sm">Your dictionary is empty.</p>`;
                }

                dictionaryItems.forEach(item => {
                    const itemEl = document.createElement('button');
                    itemEl.className = 'w-full text-left px-3 py-3 border-b border-gray-200 hover:bg-gray-50 text-sm';
                    itemEl.dataset.id = item.id;

                    if (item.type === 'word') {
                        itemEl.textContent = item.word;
                    } else {
                        itemEl.innerHTML = `
                            <span class="opacity-70">${item.from}</span>
                            <span class="mx-2 text-[#0B4F75]">&rarr;</span>
                            <span class="font-semibold">${item.to}</span>
                        `;
                    }

                    // Add click listener to edit
                    itemEl.addEventListener('click', () => openEditModal(item.id));
                    listContainer.appendChild(itemEl);
                });
            };

            // Toggle the inputs in the modal OR the add form
            const updateFormInputs = (isReplacement, context) => {
                const elements = {
                    singleContainer: context === 'add' ? addFormSingleWordContainer : singleWordContainer,
                    replacementContainer: context === 'add' ? addFormReplacementContainer : replacementInputContainer,
                    toggle: context === 'add' ? addFormMisspellingToggle : misspellingToggle,
                    toggleButton: context === 'add' ? addFormToggleButton : toggleButton,
                };
                
                // Manually update the state and styling of the toggle button/track
                const updateToggleVisuals = (isChecked, buttonEl) => {
                    const trackEl = buttonEl.querySelector('.toggle-track');
                    const ballEl = buttonEl.querySelector('.toggle-ball');

                    if (isChecked) {
                        trackEl.classList.remove('bg-gray-300');
                        trackEl.classList.add('bg-[#0B4F75]');
                        ballEl.style.transform = 'translateX(1.5rem)';
                        buttonEl.setAttribute('aria-checked', 'true');
                        elements.toggle.checked = true;
                    } else {
                        trackEl.classList.remove('bg-[#0B4F75]');
                        trackEl.classList.add('bg-gray-300');
                        ballEl.style.transform = 'translateX(0)';
                        buttonEl.setAttribute('aria-checked', 'false');
                        elements.toggle.checked = false;
                    }
                };
                
                // Apply visual update
                updateToggleVisuals(isReplacement, elements.toggleButton);


                if (isReplacement) {
                    elements.singleContainer.classList.add('hidden');
                    elements.replacementContainer.classList.remove('hidden');
                } else {
                    elements.singleContainer.classList.remove('hidden');
                    elements.replacementContainer.classList.add('hidden');
                }
            };

            const closeModal = () => {
                modalOverlay.classList.add('hidden');
                editModal.classList.add('hidden');
                editingItemId = null; // Clear editing state
            };

            const openEditModal = (id) => {
                const item = dictionaryItems.find(i => i.id === id);
                if (!item) return;

                editingItemId = id;
                modalTitle.textContent = 'Edit word';
                saveButton.textContent = 'Save changes';
                deleteButton.classList.remove('hidden');

                if (item.type === 'word') {
                    updateFormInputs(false, 'edit');
                    singleWordInput.value = item.word;
                    wordToReplaceInput.value = '';
                    replaceWithInput.value = '';
                } else {
                    updateFormInputs(true, 'edit');
                    wordToReplaceInput.value = item.from;
                    replaceWithInput.value = item.to;
                    singleWordInput.value = '';
                }

                modalOverlay.classList.remove('hidden');
                editModal.classList.remove('hidden');
            };

            const handleSave = () => {
                if (!editingItemId) return; // This button only saves edits

                const isReplacement = misspellingToggle.checked;
                let updatedItem;

                if (isReplacement) {
                    const from = wordToReplaceInput.value.trim();
                    const to = replaceWithInput.value.trim();
                    if (!from || !to) return; // Basic validation
                    updatedItem = { id: editingItemId, type: 'replacement', from, to };
                } else {
                    const word = singleWordInput.value.trim();
                    if (!word) return; // Basic validation
                    updatedItem = { id: editingItemId, type: 'word', word };
                }
                
                // Update existing item
                dictionaryItems = dictionaryItems.map(item => item.id === editingItemId ? updatedItem : item);

                renderList();
                closeModal();
            };

            const handleAddItem = () => {
                const isReplacement = addFormMisspellingToggle.checked;
                let newItem;

                if (isReplacement) {
                    const from = addFormWordToReplaceInput.value.trim();
                    const to = addFormReplaceWithInput.value.trim();
                    if (!from || !to) return; // Basic validation
                    newItem = { id: crypto.randomUUID(), type: 'replacement', from, to };
                    
                    // Clear inputs
                    addFormWordToReplaceInput.value = '';
                    addFormReplaceWithInput.value = '';
                } else {
                    const word = addFormSingleWordInput.value.trim();
                    if (!word) return; // Basic validation
                    newItem = { id: crypto.randomUUID(), type: 'word', word };

                    // Clear input
                    addFormSingleWordInput.value = '';
                }

                dictionaryItems.push(newItem);
                renderList();
            };

            const handleDelete = () => {
                if (!editingItemId) return;
                dictionaryItems = dictionaryItems.filter(item => item.id !== editingItemId);
                renderList();
                closeModal();
            };

            // --- EVENT LISTENERS ---
            cancelButton.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', closeModal);
            
            // Edit Modal Listeners
            toggleButton.addEventListener('click', () => {
                const isChecked = !misspellingToggle.checked;
                updateFormInputs(isChecked, 'edit');
            });
            saveButton.addEventListener('click', handleSave);
            deleteButton.addEventListener('click', handleDelete);

            // Add Form Listeners
            addFormToggleButton.addEventListener('click', () => {
                const isChecked = !addFormMisspellingToggle.checked;
                updateFormInputs(isChecked, 'add');
            });
            addFormSaveButton.addEventListener('click', handleAddItem);

            // --- INITIAL RENDER ---
            renderList();
            
            // Set initial state for add form toggle
            updateFormInputs(false, 'add');
        });
    </script>
</body>
</html>
